---
layout: base.njk
title: Get Started
description: Sign up for Bethany and start staying connected to the people who matter.
---

<section class="pt-32 pb-20 md:pt-40 relative">
  <div class="gradient-blob w-72 h-72 bg-sage/20 top-20 right-0"></div>
  <div class="gradient-blob w-64 h-64 bg-terracotta/15 bottom-0 left-0"></div>
  
  <div class="max-w-xl mx-auto px-6 relative z-10">
    <div class="text-center mb-10">
      <h1 class="text-4xl md:text-5xl font-display font-medium text-charcoal mb-4">
        Let's get you started
      </h1>
      <p class="text-xl text-charcoal-light">
        Just a few quick things and I'll start helping you stay connected.
      </p>
    </div>
    
    <div class="card">
      <form id="signup-form" class="space-y-6" novalidate autocomplete="off">
        <div>
          <label for="name" class="block text-charcoal font-medium mb-2">What should I call you?</label>
          <input type="text" id="name" name="name" class="input-field" placeholder="Your first name" required autocomplete="off">
          <p class="error-message hidden" data-error="name"></p>
        </div>
        
        <div>
          <label for="email" class="block text-charcoal font-medium mb-2">Email address</label>
          <input type="email" id="email" name="email" class="input-field" placeholder="you@example.com" required autocomplete="off">
          <p class="error-message hidden" data-error="email"></p>
        </div>
        
        <div>
          <label for="phone" class="block text-charcoal font-medium mb-2">Phone number</label>
          <input type="tel" id="phone" name="phone" class="input-field" placeholder="(555) 123-4567" required autocomplete="off">
          <p class="text-charcoal-light text-sm mt-1">I'll text you here. US numbers only for now.</p>
          <p class="error-message hidden" data-error="phone"></p>
        </div>
        
        <div>
          <label for="pin" class="block text-charcoal font-medium mb-2">Create a 4-digit PIN</label>
          <input type="password" id="pin" name="pin" class="input-field" placeholder="••••" maxlength="4" pattern="[0-9]{4}" inputmode="numeric" required autocomplete="new-password">
          <p class="text-charcoal-light text-sm mt-1">You'll use this to confirm important actions via text.</p>
          <p class="error-message hidden" data-error="pin"></p>
        </div>
        
        <div class="flex items-start gap-3">
          <input type="checkbox" id="terms" name="terms" required class="mt-1">
          <label for="terms" class="text-charcoal-light text-sm leading-relaxed">
            I agree to the <a href="/terms" class="text-terracotta hover:underline">Terms of Service</a> and <a href="/privacy" class="text-terracotta hover:underline">Privacy Policy</a>. I understand Bethany will text me.
          </label>
        </div>
        <p class="error-message hidden" data-error="terms"></p>
        
        <button type="submit" class="btn-primary w-full" id="submit-btn">
          <span id="btn-text">Start my free account</span>
          <span id="btn-loading" class="hidden">
            <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </span>
        </button>
        
        <div id="form-error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm"></div>
      </form>
      
      <div class="mt-6 pt-6 border-t border-charcoal/10 text-center">
        <p class="text-charcoal-light text-sm">
          Already have an account? <a href="{{ site.dashboardUrl }}/login" class="text-terracotta hover:underline font-medium">Log in →</a>
        </p>
      </div>
    </div>
    
    <p class="text-center text-charcoal-light text-sm mt-8">Free plan includes 15 contacts. No credit card required.</p>
  </div>
</section>

<script>
(function() {
  const form = document.getElementById('signup-form');
  const submitBtn = document.getElementById('submit-btn');
  const btnText = document.getElementById('btn-text');
  const btnLoading = document.getElementById('btn-loading');
  const formError = document.getElementById('form-error');
  const phoneInput = document.getElementById('phone');
  const pinInput = document.getElementById('pin');
  const API_URL = '{{ site.apiUrl }}';
  const DASHBOARD_URL = '{{ site.dashboardUrl }}';

  // Track cursor position for phone formatting
  let previousPhoneValue = '';

  // Normalize phone to 10 digits (handles +1 prefix from autofill)
  function normalizePhoneDigits(raw) {
    let digits = raw.replace(/\D/g, '');
    // Strip leading 1 if we have 11 digits (US country code)
    if (digits.length === 11 && digits.startsWith('1')) {
      digits = digits.slice(1);
    }
    return digits.slice(0, 10);
  }

  // Format phone for display: (555) 123-4567
  function formatPhoneDisplay(digits) {
    if (digits.length === 0) return '';
    if (digits.length <= 3) return '(' + digits;
    if (digits.length <= 6) return '(' + digits.slice(0, 3) + ') ' + digits.slice(3);
    return '(' + digits.slice(0, 3) + ') ' + digits.slice(3, 6) + '-' + digits.slice(6);
  }

  phoneInput.addEventListener('input', function(e) {
    const cursorPos = e.target.selectionStart;
    const oldValue = previousPhoneValue;
    const newRaw = e.target.value;
    
    // Get just the digits
    const digits = normalizePhoneDigits(newRaw);
    const formatted = formatPhoneDisplay(digits);
    
    // Update the value
    e.target.value = formatted;
    previousPhoneValue = formatted;
    
    // Try to maintain reasonable cursor position
    // If user is deleting, keep cursor where it was (adjusted for format changes)
    if (newRaw.length < oldValue.length) {
      // Deleting - find appropriate cursor position
      const newCursorPos = Math.min(cursorPos, formatted.length);
      e.target.setSelectionRange(newCursorPos, newCursorPos);
    } else {
      // Adding - put cursor at end of new content
      e.target.setSelectionRange(formatted.length, formatted.length);
    }
  });

  // Handle backspace/delete specially for phone
  phoneInput.addEventListener('keydown', function(e) {
    if (e.key === 'Backspace' || e.key === 'Delete') {
      const cursorPos = e.target.selectionStart;
      const value = e.target.value;
      
      // If cursor is right after a formatting character, move it back
      if (e.key === 'Backspace' && cursorPos > 0) {
        const charBefore = value[cursorPos - 1];
        if (charBefore === ')' || charBefore === ' ' || charBefore === '-' || charBefore === '(') {
          // Find the previous digit and delete that instead
          e.preventDefault();
          const digits = normalizePhoneDigits(value);
          if (digits.length > 0) {
            const newDigits = digits.slice(0, -1);
            const formatted = formatPhoneDisplay(newDigits);
            e.target.value = formatted;
            previousPhoneValue = formatted;
            e.target.setSelectionRange(formatted.length, formatted.length);
          }
        }
      }
    }
  });

  // PIN - only allow digits, mask input
  pinInput.addEventListener('input', function(e) {
    e.target.value = e.target.value.replace(/\D/g, '').slice(0, 4);
  });

  // Prevent non-digit keypress on PIN
  pinInput.addEventListener('keypress', function(e) {
    if (!/[0-9]/.test(e.key) && e.key !== 'Backspace' && e.key !== 'Delete' && e.key !== 'Tab') {
      e.preventDefault();
    }
  });

  function showError(field, message) {
    const errorEl = document.querySelector('[data-error="' + field + '"]');
    const inputEl = document.getElementById(field);
    if (errorEl) { errorEl.textContent = message; errorEl.classList.remove('hidden'); }
    if (inputEl) { inputEl.classList.add('input-error'); }
  }

  function clearErrors() {
    document.querySelectorAll('.error-message').forEach(function(el) { el.classList.add('hidden'); });
    document.querySelectorAll('.input-error').forEach(function(el) { el.classList.remove('input-error'); });
    formError.classList.add('hidden');
  }

  function setLoading(loading) {
    submitBtn.disabled = loading;
    btnText.classList.toggle('hidden', loading);
    btnLoading.classList.toggle('hidden', !loading);
  }

  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    clearErrors();
    
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const phone = normalizePhoneDigits(document.getElementById('phone').value);
    const pin = document.getElementById('pin').value;
    const terms = document.getElementById('terms').checked;
    
    let hasError = false;
    if (!name) { showError('name', 'Please enter your name'); hasError = true; }
    if (!email || !email.includes('@')) { showError('email', 'Please enter a valid email address'); hasError = true; }
    if (phone.length !== 10) { showError('phone', 'Please enter a valid 10-digit phone number'); hasError = true; }
    if (pin.length !== 4) { showError('pin', 'Please enter a 4-digit PIN'); hasError = true; }
    if (!terms) { showError('terms', 'Please accept the terms to continue'); hasError = true; }
    if (hasError) return;
    
    setLoading(true);
    
    try {
      const response = await fetch(API_URL + '/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ 
          name: name, 
          email: email, 
          phone: '+1' + phone, 
          pin: pin, 
          termsAccepted: true 
        })
      });
      
      const data = await response.json();
      
      if (!response.ok) {
        // Handle field-specific errors
        if (data.field) {
          showError(data.field, data.error);
        } else {
          throw new Error(data.error || 'Something went wrong. Please try again.');
        }
        return;
      }
      
      // Success! Redirect to the dashboard welcome page
      if (data.redirectUrl) {
        window.location.href = data.redirectUrl;
      } else {
        window.location.href = DASHBOARD_URL + '/welcome';
      }
      
    } catch (error) {
      formError.textContent = error.message;
      formError.classList.remove('hidden');
    } finally {
      setLoading(false);
    }
  });
})();
</script>
